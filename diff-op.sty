\NeedsTeXFormat{LaTeX2e}
\ProvidesExplPackage{diff-op}{2026-02-13}{0.2.0}{Provide beautiful and easy to use math differentials}

\ExplSyntaxOn

\keys_define:nn {diffop_setup}
  {
    renewnabla .bool_set:N = \l_diffop_renewnabla_bool,
    renewnabla .default:n = {false},
    renewnabla .initial:n = {false}
  }

\NewDocumentCommand {\diffopsetup} {m}
  {
    \keys_set:nn {diffop_setup} {#1}
    \bool_if:NT \l_diffop_renewnabla_bool
      {
        \renewcommand{\nabla}{\raisebox{0.5ex}{$\bigtriangledown$}}
      }
  }

\msg_new:nnn {diff-op} {outside_math_mode}
  {Can~not~use~`\exp_not:n {#1}'~outside~math~mode.}

\NewDocumentCommand {\grad} {s}%
  {%
    \if_mode_math:%
      \bool_if:NTF #1%
        {%
          \mathrm{grad}\,%
        }%
        {%
          \nabla%
        }%
    \else:%
      \msg_error:nnn {diff-op} {outside_math_mode} {\grad}%
    \fi:%
  }

\RenewDocumentCommand {\div} {s}%
  {%
    \if_mode_math:%
      \bool_if:NTF #1%
        {%
          \mathrm{div}\,%
        }%
        {%
          \nabla\!\cdot\!%
        }%
    \else:%
      \msg_error:nnn {diff-op} {outside_math_mode} {\div}%
    \fi:%
  }

\NewDocumentCommand {\rot} {s}%
  {%
    \if_mode_math:%
      \bool_if:NTF #1%
        {%
          \mathrm{rot}\,%
        }%
        {%
          \nabla\!\times\!%
        }%
    \else:%
      \msg_error:nnn {diff-op} {outside_math_mode} {\rot}%
    \fi:%
  }

\ExplSyntaxOff

\endinput